<%- include('./partials/navback') %>

<main class="container mx-auto px-4 pt-20 pb-16">
    <!-- Contestant Profile -->
    <div class="bg-white rounded-2xl shadow-xl overflow-hidden mb-8 contestant-profile" data-contestant-id="<%= contestant.id %>">
        <div class="md:flex">
            <div class="md:w-1/3 h-64 md:h-auto bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center">
                <span class="text-8xl">ðŸŽ­</span>
            </div>
            <div class="md:w-2/3 p-8">
                <div class="flex justify-between items-start">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2"><%= contestant.name %></h1>
                        <p class="text-purple-600 font-semibold mb-4">Contestant #<%= contestant.contestant_number %></p>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold text-purple-700 vote-count-<%= contestant.id %>">
                            <%= contestant.votes.toLocaleString() %>
                        </div>
                        <div class="text-sm text-gray-500">total votes</div>
                    </div>
                </div>
                
                <p class="text-gray-600 mb-6"><%= contestant.bio %></p>
                
                <% if (user) { %>
                <!-- Vote Controls -->
                <div class="space-y-4 vote-controls">
                    <!-- Vote counter with plus/minus -->
                    <div class="flex items-center justify-between bg-gray-50 rounded-lg p-4">
                        <button onclick="adjustVote('<%= contestant.id %>', -1)" 
                                class="vote-btn w-12 h-12 bg-gray-200 hover:bg-gray-300 rounded-lg text-2xl font-bold transition">
                            âˆ’
                        </button>
                        
                        <div class="text-center">
                            <div class="text-3xl font-bold text-gray-800 selected-votes" id="selected-votes-<%= contestant.id %>">1</div>
                            <div class="text-sm text-gray-600">votes to cast</div>
                            <div class="text-xs font-medium text-purple-600 bg-purple-50 px-2 py-1 rounded-full mt-1">
                                <span class="coin-required" id="coin-required-<%= contestant.id %>">10</span> coins
                            </div>
                        </div>
                        
                        <button onclick="adjustVote('<%= contestant.id %>', 1)" 
                                class="vote-btn w-12 h-12 bg-gray-200 hover:bg-gray-300 rounded-lg text-2xl font-bold transition">
                            +
                        </button>
                    </div>

                    <!-- Quick vote buttons -->
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="castVote('<%= contestant.id %>', 1)" 
                                class="vote-btn px-4 py-3 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition font-semibold border-2 border-purple-300">
                            âš¡ Vote 1 (10 coins)
                        </button>
                        <button onclick="castVoteWithCurrent('<%= contestant.id %>')" 
                                class="vote-btn px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold">
                            Cast Selected (<span class="selected-votes-display">1</span> votes)
                        </button>
                    </div>
                    
                    <!-- Bulk Vote Presets -->
                    <div class="grid grid-cols-3 gap-3">
                        <button onclick="castVote('<%= contestant.id %>', 5)" 
                                class="vote-btn px-4 py-3 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition font-medium">
                            5 votes<br><span class="text-xs">(50 coins)</span>
                        </button>
                        <button onclick="castVote('<%= contestant.id %>', 10)" 
                                class="vote-btn px-4 py-3 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition font-medium">
                            10 votes<br><span class="text-xs">(100 coins)</span>
                        </button>
                        <button onclick="castVote('<%= contestant.id %>', 20)" 
                                class="vote-btn px-4 py-3 bg-purple-50 hover:bg-purple-100 text-purple-700 rounded-lg transition font-medium">
                            20 votes<br><span class="text-xs">(200 coins)</span>
                        </button>
                    </div>
                    
                    <!-- Mega vote -->
                    <button onclick="castVote('<%= contestant.id %>', 50)" 
                            class="vote-btn w-full px-6 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:opacity-90 transition font-bold text-lg">
                        Vote 50 Times (500 coins) âš¡âš¡âš¡
                    </button>
                </div>
                <% } else { %>
                <a href="/auth/login" 
                   class="block w-full px-6 py-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-semibold text-center">
                    Login to Vote
                </a>
                <% } %>
            </div>
        </div>
    </div>

    <!-- other contestants -->

    <p>other contestants</p>
    
        <div id="leaderboard" class="bg-white rounded-xl shadow-lg p-4">
            <% contestants.slice(0, 5).forEach((contestant, index) => { %>
            <div class="flex items-center justify-between p-3 <%= index < 3 ? 'bg-gradient-to-r from-yellow-50 to-orange-50' : 'hover:bg-gray-50' %> rounded-lg transition mb-2">
                <div class="flex items-center space-x-4">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full 
                        <%= index === 0 ? 'bg-yellow-400' : index === 1 ? 'bg-gray-300' : index === 2 ? 'bg-orange-300' : 'bg-gray-200' %>">
                        <span class="font-bold <%= index < 3 ? 'text-white' : 'text-gray-700' %>"><%= index + 1 %></span>
                    </div>
                    <div>
                        <div class="font-semibold text-gray-800">
                            
                            <a href="/contestant/<%= contestant.id %>">

                                <%= contestant.name %>
                        </a>
                    </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="font-bold text-purple-700 vote-count-<%= contestant.id %>"><%= contestant.votes.toLocaleString() %></div>
                    <div class="text-xs text-gray-500">votes</div>
                </div>
            </div>
            <% }) %>
        </div>
</main>

<%- include('./partials/navbottom') %>
<script>
// Pass contestant ID to global scope
window.currentContestantId = '<%= contestant.id %>';
</script>
<script src="/js/client.js"></script>