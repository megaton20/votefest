<!-- Navigation -->
<nav class="bg-white shadow-lg fixed top-0 w-full z-50">
    <div class="container mx-auto px-4 py-3">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full"></div>
            </div>
            <div class="flex items-center space-x-4">
                <% if (user) { %>
                    <a href="/wallet" class="flex items-center space-x-2 px-4 py-2 bg-purple-50 rounded-lg hover:bg-purple-100 transition">
                        <span class="text-purple-700 font-semibold" id="coin-balance">0</span>
                        <span class="text-gray-600">coins</span>
                    </a>
                    <a href="/auth/logout" class="px-4 py-2 text-gray-600 hover:text-gray-800">Logout</a>
                <% } else { %>
                    <a href="/leaderboard" class="text-gray-600 hover:text-purple-600">Leaderboard</a>
                    <a href="/auth/login" class="px-4 py-2 text-purple-600 hover:text-purple-800">Login</a>
                    <a href="/auth/register" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Register</a>
                <% } %>
            </div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="container mx-auto px-4 pt-20 pb-16">
    <!-- Hero Section -->
    <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">VoteFest 2024</h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">Support your favorite contestants in real-time. Every vote counts!</p>
    </div>

    <!-- Live Leaderboard -->
    <div class="mb-12">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                <span class="ml-3 px-3 py-1 bg-red-100 text-red-600 text-xs font-semibold rounded-full animate-pulse">LIVE</span>
            </h2>
            <div class="flex items-center space-x-4">
                <div class="text-sm text-gray-600">
                    <span class="font-semibold text-purple-600" id="total-votes"><%= totalVotes.toLocaleString() %></span> total votes
                </div>
                <a href="/leaderboard" class="text-sm text-purple-600 hover:text-purple-800 font-semibold">
                    View Full Leaderboard â†’
                </a>
            </div>
        </div>
        
        <div id="leaderboard" class="bg-white rounded-xl shadow-lg p-4">
            <% contestants.slice(0, 5).forEach((contestant, index) => { %>
            <div class="flex items-center justify-between p-3 <%= index < 3 ? 'bg-gradient-to-r from-yellow-50 to-orange-50' : 'hover:bg-gray-50' %> rounded-lg transition mb-2">
                <div class="flex items-center space-x-4">
                    <div class="w-8 h-8 flex items-center justify-center rounded-full 
                        <%= index === 0 ? 'bg-yellow-400' : index === 1 ? 'bg-gray-300' : index === 2 ? 'bg-orange-300' : 'bg-gray-200' %>">
                        <span class="font-bold <%= index < 3 ? 'text-white' : 'text-gray-700' %>"><%= index + 1 %></span>
                    </div>
                    <div>
                        <div class="font-semibold text-gray-800"><%= contestant.name %></div>
                        <div class="text-sm text-gray-600">#<%= contestant.contestant_number %></div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="font-bold text-purple-700 vote-count-<%= contestant.id %>"><%= contestant.votes.toLocaleString() %></div>
                    <div class="text-xs text-gray-500">votes</div>
                </div>
            </div>
            <% }) %>
        </div>
    </div>

    <!-- Contestants Grid -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <span class="mr-2">ðŸŒŸ</span> All Contestants
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <% contestants.forEach(contestant => { %>
            <div class="contestant-card bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 hover:-translate-y-1"
                 data-contestant-id="<%= contestant.id %>">
                <div class="relative">
                    <div class="w-full h-48 bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center">
                        <span class="text-6xl">ðŸŽ­</span>
                    </div>
                    <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm rounded-full px-3 py-1">
                        <span class="font-bold text-purple-700">#<%= contestant.contestant_number %></span>
                    </div>
                    <div class="absolute top-4 left-4 bg-purple-600 text-white px-3 py-1 rounded-full text-sm">
                        Rank #<%= contestant.rank %>
                    </div>
                </div>
                
                <div class="p-6">
                   <a href="/contestant/<%= contestant.id %>">
                     <h3 class="text-xl font-bold text-gray-800 mb-2"><%= contestant.name %></h3>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2"><%= contestant.bio %></p>
                    </a>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <div class="text-2xl font-bold text-purple-700 vote-count-<%= contestant.id %>">
                                <%= contestant.votes.toLocaleString() %>
                            </div>
                            <div class="text-xs text-gray-500">votes acquired</div>
                        </div>
                    </div>
                    
                <% if (user) { %>
                <!-- Vote Controls -->
                <div class="space-y-2 vote-controls">
                    <div class="flex items-center justify-between bg-gray-50 rounded-lg p-2">
                        <button class="vote-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition text-xl font-bold"
                                onclick="adjustVote('<%= contestant.id %>', -1)">
                            âˆ’
                        </button>

                        <div class="text-center">
                            <span class="text-sm font-bold text-gray-800 selected-votes" id="selected-votes-<%= contestant.id %>">1</span>
                            <span class="text-sm text-gray-600">vote(s)</span>
                            <span class="text-xs text-purple-600 coin-required" id="coin-required-<%= contestant.id %>">10</span>
                            <span class="text-xs text-gray-500"> coins</span>
                        </div>

                        <button class="vote-btn px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition text-xl font-bold"
                                onclick="adjustVote('<%= contestant.id %>', 1)">
                            +
                        </button>
                    </div>
                    
                    <!-- ADD THIS: Cast Selected button -->
                    <button onclick="castVoteWithCurrent('<%= contestant.id %>')" 
                            class="vote-btn w-full px-3 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition text-sm font-medium mb-2">
                        âš¡ Cast <span class="selected-votes-display" data-contestant="<%= contestant.id %>">1</span> Selected Votes (<span class="selected-coins-display" data-contestant="<%= contestant.id %>">10</span> coins)
                    </button>
                    
                    <!-- Quick Actions -->
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="castVote('<%= contestant.id %>', 1)" 
                                class="vote-btn px-3 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition text-sm font-small">
                            Vote 1 (10 coins)
                        </button>
                        <button onclick="castVote('<%= contestant.id %>', 5)" 
                                class="vote-btn px-3 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition text-sm font-small">
                            5 votes (50 coins)
                        </button>
                    </div>
                    
                    <!-- Preset vote buttons -->
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="castVote('<%= contestant.id %>', 10)" 
                                class="vote-btn px-3 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition text-sm font-small">
                            10 votes (100 coins)
                        </button>
                        <button onclick="castVote('<%= contestant.id %>', 20)" 
                                class="vote-btn px-3 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition text-sm font-small">
                            20 votes (200 coins)
                        </button>
                    </div>
                    
                    
                </div>
                <% } else { %>
                <a href="/auth/login"
                class="block w-full text-center px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-semibold">
                    Login to Vote
                </a>
                <% } %>
                </div>
            </div>
            <% }) %>
        </div>
    </div>
</main>

<%- include('./partials/navbottom') %>

<!-- Padding for mobile bottom nav -->
<div class="h-16 md:hidden"></div>

<script src="/js/client.js"></script>